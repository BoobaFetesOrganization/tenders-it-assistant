{
  "subscription": "subscription-pay-as-you-go",
  "location": "francecentral",
  "tags": [
    {
      "name": "project",
      "value": "tenders-it-assistant"
    },
    {
      "name": "for",
      "value": "devoteam"
    }
  ],
  "resources": [
    {
      "kind": "resource group",
      "name": "tenders-it-assistant-rg"
    },
    {
      "kind": "appservice plan",
      "name": "tenders-it-assistant-app-service-plan",
      "resourceGroup": "tenders-it-assistant-rg",
      "sku": "F1"
    },
    {
      "kind": "webapp",
      "name": "tenders-it-assistant-web-app",
      "plan": "tenders-it-assistant-app-service-plan",
      "resourceGroup": "tenders-it-assistant-rg",
      "runtime": "dotnet:9",
      "deployment": {
        "source": "github",
        "branch": "main",
        "repoUrl": "https://github.com/BoobaFetes/tenders-it-assistant"
      },
      "servicePrincipal": "tenders-it-assistant-web-app-deploy-sp"
    },
    {
      "kind": "storage account",
      "name": "tendersassiststorage",
      "resourceGroup": "tenders-it-assistant-rg",
      "sku": "Standard_LRS",
      "azure-kind": "StorageV2"
    },
    {
      "kind": "storage table",
      "name": "database",
      "account": "tendersassiststorage"
    },
    {
      "kind": "log analytics workspace",
      "name": "tenders-it-assistant-log-analytics",
      "resourceGroup": "tenders-it-assistant-rg",
      "sku": "PerGB2018",
      "servicePrincipal": "tenders-it-assistant-log-analytics-sp"
    },
    {
      "kind": "monitor data-collection endpoint",
      "name": "tenders-it-assistant-dce",
      "resourceGroup": "tenders-it-assistant-rg",
      "public-network-access": "Enabled",
      "azure-kind": "Linux"
    },
    {
      "kind": "log analytics workspace table",
      "name": "WebApp_CL",
      "workspaceName": "tenders-it-assistant-log-analytics",
      "resourceGroup": "tenders-it-assistant-rg",
      "columnsFile": "./templates/log-analytics--table-columns.txt",
      "plan": "Analytics"
    },
    {
      "kind": "monitor data-collection rule",
      "name": "tenders-it-assistant-WebAppLogs-dcr",
      "template": {
        "file": "./templates/log-analytics--dcr.json",
        "mapping": [
          {
            "placeholder": "<location>",
            "path": "location"
          },
          {
            "placeholder": "<rule_name>",
            "path": "resources[kind='monitor data-collection rule'].name"
          },
          {
            "placeholder": "<table_name>",
            "path": "resources[kind='log analytics workspace table'].name"
          },
          {
            "placeholder": "<workspace_id>",
            "path": "$ref|workspace.id"
          },
          {
            "placeholder": "<workspace_name>",
            "path": "$ref|workspace.name"
          },
          {
            "placeholder": "<workspace_customerId>",
            "path": "$ref|workspace.customerId"
          },
          {
            "placeholder": "<endpoint_id>",
            "path": "$ref|endpoint.id"
          }
        ]
      },
      "resourceGroup": "tenders-it-assistant-rg",
      "endpoint": "tenders-it-assistant-dce"
    }
  ]
}
